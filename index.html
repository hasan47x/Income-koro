<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>Earn & Reward App (Firebase)</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />

  <style>
:root{
  --font-family:'Nunito',sans-serif;
  --bg-color-light:#f4f4f9; --secondary-bg-light:#fff; --text-color-light:#1c1c1e; --subtle-text-light:#6d6d72; --primary-color-light:#007aff; --border-color-light:#e0e0e0;
  --bg-color-dark:#121212;  --secondary-bg-dark:#1c1c1e;  --text-color-dark:#fff;   --subtle-text-dark:#8e8e93;  --primary-color-dark:#0a84ff;  --border-color-dark:#38383a;
}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:var(--font-family);transition:background-color .3s,color .3s;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}
body.light-theme{background:#f4f4f9;color:#1c1c1e}
body.dark-theme{background:#121212;color:#fff}
#app{max-width:500px;margin:0 auto;padding-bottom:86px}
#boot-overlay{position:fixed;inset:0;z-index:3000;display:flex;align-items:center;justify-content:center;background:radial-gradient(1000px 600px at 80% -10%, rgba(124,77,255,.18), transparent 60%),radial-gradient(800px 500px at 10% 120%, rgba(46,221,235,.12), transparent 60%),rgba(0,0,0,.65);backdrop-filter:saturate(160%) blur(6px)}
.boot-card{width:90%;max-width:420px;padding:28px;border-radius:18px;text-align:center;background:linear-gradient(180deg,#1c1c1e,#141414);border:1px solid rgba(255,255,255,.08);color:#fff;box-shadow:0 24px 60px rgba(0,0,0,.45)}
.boot-logo{width:66px;height:66px;border-radius:50%;display:grid;place-items:center;margin:0 auto 14px;background:conic-gradient(from 0deg, #6d5dfc, #4f46e5, #30d158, #6d5dfc);animation:spin 2.2s linear infinite}
.boot-logo i{font-size:28px;color:#fff}
.boot-title{font-weight:800;font-size:1.1rem;margin-bottom:6px}
.boot-sub{opacity:.85;font-size:.95rem}
.boot-progress{height:6px;border-radius:999px;background:rgba(255,255,255,.12);margin:16px 0 4px;overflow:hidden}
.boot-bar{height:100%;width:20%;border-radius:999px;background:linear-gradient(90deg,#6d5dfc,#4f46e5);animation:loaderBar 1.5s ease-in-out infinite}
.boot-hint{opacity:.8;font-size:.85rem}
@keyframes loaderBar{0%{transform:translateX(-30%)}50%{transform:translateX(70%)}100%{transform:translateX(130%)}}
@keyframes spin{to{transform:rotate(360deg)}}
.skel{position:relative;overflow:hidden;background:rgba(255,255,255,.04);border-radius:10px}
.skel::after{content:"";position:absolute;inset:0;background:linear-gradient(90deg, transparent, rgba(255,255,255,.12), transparent);transform:translateX(-100%);animation:shimmer 1.4s infinite}
@keyframes shimmer{100%{transform:translateX(100%)}}
.skel-avatar{width:60px;height:60px;border-radius:50%}
.skel-line{height:14px;border-radius:6px}
.skel-line.w60{width:60%}.skel-line.w40{width:40%}.skel-line.w80{width:80%}
.profile-header{padding:20px 15px;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid}
.light-theme .profile-header{border-bottom-color:#e0e0e0}
.dark-theme  .profile-header{border-bottom-color:#38383a}
.profile-info{display:flex;align-items:center;gap:15px}
#user-photo{width:60px;height:60px;border-radius:50%;object-fit:cover;border:2px solid}
.light-theme #user-photo{border-color:#007aff}
.dark-theme  #user-photo{border-color:#0a84ff}
.user-details h1{font-size:1.2rem;font-weight:700}
.verified-icon{font-size:1rem;margin-left:5px}
.light-theme .verified-icon{color:#007aff}
.dark-theme  .verified-icon{color:#0a84ff}
.user-details p{font-size:.9rem;font-weight:600}
.light-theme .user-details p{color:#6d6d72}
.dark-theme  .user-details p{color:#8e8e93}
.mini-app-badge{display:none;align-items:center;gap:8px;padding:6px 12px;border-radius:999px;font-weight:800;font-size:.75rem;border:1px solid}
.light-theme .mini-app-badge{background:#eef6ff;color:#0a3d8f;border-color:#bcd8ff}
.dark-theme  .mini-app-badge{background:#0b2545;color:#cfe6ff;border-color:#123}
main{padding:15px}
.page{display:none}
.page.active{display:block;animation:fadeIn .3s ease-in-out}
@keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
h2{font-size:1.5rem;margin-bottom:15px}
.stats-grid{display:grid;grid-template-columns:1fr 1fr;gap:15px;margin-top:20px}
.stat-card{padding:20px;border-radius:12px;text-align:center}
.light-theme .stat-card{background:#fff;border:1px solid #e0e0e0}
.dark-theme  .stat-card{background:#1c1c1e;border:1px solid #38383a}
.stat-card h3{font-size:.9rem;margin-bottom:10px}
.light-theme .stat-card h3{color:#6d6d72}
.dark-theme  .stat-card h3{color:#8e8e93}
.stat-card p{font-size:1.5rem;font-weight:700}
.light-theme .stat-card p{color:#007aff}
.dark-theme  .stat-card p{color:#0a84ff}

/* Added styles for leaderboard snapshot and notice section */
.leaderboard-section, .notice-section{margin-top:20px;padding:20px;border-radius:12px}
.light-theme .leaderboard-section, .light-theme .notice-section{background:#fff;border:1px solid #e0e0e0}
.dark-theme .leaderboard-section, .dark-theme .notice-section{background:#1c1c1e;border:1px solid #38383a}
.leaderboard-section h3, .notice-section h3{font-size:1.1rem;margin-bottom:15px;display:flex;align-items:center;gap:8px}
.leaderboard-section h3 i, .notice-section h3 i{font-size:1rem}
.light-theme .leaderboard-section h3 i, .light-theme .notice-section h3 i{color:#007aff}
.dark-theme .leaderboard-section h3 i, .dark-theme .notice-section h3 i{color:#0a84ff}
.leaderboard-item{display:flex;align-items:center;gap:12px;padding:12px;margin-bottom:8px;border-radius:8px}
.light-theme .leaderboard-item{background:rgba(0,0,0,0.02)}
.dark-theme .leaderboard-item{background:rgba(255,255,255,0.03)}
.leaderboard-rank{width:32px;height:32px;display:grid;place-items:center;border-radius:50%;font-weight:700;font-size:0.9rem}
.leaderboard-rank.rank-1{background:linear-gradient(135deg, #ffd700, #ffed4e);color:#000}
.leaderboard-rank.rank-2{background:linear-gradient(135deg, #c0c0c0, #e8e8e8);color:#000}
.leaderboard-rank.rank-3{background:linear-gradient(135deg, #cd7f32, #e8a87c);color:#000}
.light-theme .leaderboard-rank.rank-other{background:#e0e0e0;color:#1c1c1e}
.dark-theme .leaderboard-rank.rank-other{background:#38383a;color:#fff}
.leaderboard-info{flex:1}
.leaderboard-name{font-weight:600;font-size:0.95rem}
.leaderboard-value{font-size:0.85rem;opacity:0.8}
.leaderboard-amount{font-weight:700}
.light-theme .leaderboard-amount{color:#007aff}
.dark-theme .leaderboard-amount{color:#0a84ff}
.notice-content{padding:15px;border-radius:8px;font-size:0.9rem;line-height:1.6}
.light-theme .notice-content{background:rgba(0,122,255,0.08);color:#1c1c1e}
.dark-theme .notice-content{background:rgba(10,132,255,0.12);color:#fff}
.notice-empty{text-align:center;opacity:0.6;font-size:0.85rem;padding:20px}

.referral-section{margin-top:30px;padding:20px;border-radius:12px}
.light-theme .referral-section{background:#fff;border:1px solid #e0e0e0}
.dark-theme  .referral-section{background:#1c1c1e;border:1px solid #38383a}
.referral-section h3{text-align:center}
#referral-link{width:100%;padding:10px;text-align:center;border:1px dashed;border-radius:8px;margin:10px 0;font-size:.9rem}
.light-theme #referral-link{border-color:#007aff;background:#f4f4f9;color:#1c1c1e}
.dark-theme  #referral-link{border-color:#0a84ff;background:#121212;color:#fff}
.ref-btns{display:flex;justify-content:center;gap:12px;margin-top:10px;flex-wrap:wrap}
.ref-btns button{flex:1;min-width:150px;padding:12px;border:none;border-radius:8px;color:#fff;cursor:pointer;font-weight:600}
.ref-text{text-align:center;margin-bottom:12px;opacity:.9;line-height:1.5}
.light-theme #copy-ref-link-btn{background:#007aff}
.dark-theme  #copy-ref-link-btn{background:#0a84ff}
.light-theme #share-on-telegram-btn{background:#34c759}
.dark-theme  #share-on-telegram-btn{background:#30d158}
.task-container{padding:20px;border-radius:12px;text-align:center;margin-bottom:20px}
.task-container:last-child{margin-bottom:0}
.light-theme .task-container{background:#fff;border:1px solid #e0e0e0}
.dark-theme  .task-container{background:#1c1c1e;border:1px solid #38383a}
.task-icon{font-size:3rem;margin-bottom:15px}
.light-theme .task-icon{color:#007aff}
.dark-theme  .task-icon{color:#0a84ff}
.task-container h3{font-size:1.2rem;margin-bottom:5px}
.task-container p{font-size:.9rem;margin-bottom:15px}
.light-theme .task-container p{color:#6d6d72}
.dark-theme  .task-container p{color:#8e8e93}
.action-btn{width:100%;padding:14px;font-size:1rem;font-weight:700;color:#fff;border:none;border-radius:10px;cursor:pointer;position:relative;display:flex;justify-content:center;align-items:center}
.light-theme .action-btn{background:#007aff}
.dark-theme  .action-btn{background:#0a84ff}
.action-btn:disabled{opacity:.6;cursor:not-allowed}
.btn-loader{width:20px;height:20px;border:3px solid rgba(255,255,255,.4);border-top-color:#fff;border-radius:50%;animation:spin 1s linear infinite;display:none}
.action-btn.loading .btn-text{visibility:hidden}
.action-btn.loading .btn-loader{display:block;position:absolute}
#ad-verify-hint{margin-bottom:8px;font-weight:700}
#ad-timer-note{margin-top:10px;font-size:.85rem;opacity:.8}
.modal{display:none;position:fixed;z-index:2000;left:0;top:0;width:100%;height:100%;background:rgba(0,0,0,.6);justify-content:center;align-items:center}
.modal-content{padding:30px;border-radius:15px;text-align:center}
.light-theme .modal-content{background:#fff}
.dark-theme .modal-content{background:#1c1c1e}
.loader{border:5px solid #f3f3f3;border-radius:50%;border-top:5px solid;width:40px;height:40px;animation:spin 1s linear infinite;margin:0 auto 15px}
.light-theme .loader{border-top-color:#007aff}
.dark-theme .loader{border-top-color:#0a84ff}
.news-overlay{position:fixed;inset:0;background:rgba(0,0,0,.55);display:none;z-index:2000}
.news-overlay.show{display:block}
.news-modal{position:fixed;z-index:2001;top:50%;left:50%;transform:translate(-50%,-50%);width:min(560px,calc(100% - 32px));border-radius:18px;background:#1c1c1e;border:1px solid rgba(255,255,255,.08);box-shadow:0 20px 60px rgba(0,0,0,.45);display:none}
body.light-theme .news-modal{background:#fff;border-color:#e7e7ef}
.news-modal.show{display:block}
.news-hero{position:relative;padding:20px 56px 10px 56px;display:flex;align-items:center;justify-content:center;gap:10px;background:linear-gradient(180deg, rgba(124,77,255,.15), transparent)}
.news-hero h3{margin:0;font-size:22px;font-weight:800;text-align:center}
.news-emoji{font-size:22px;line-height:1}
.news-close{position:absolute;top:10px;right:10px;width:36px;height:36px;display:grid;place-items:center;border-radius:10px;border:1px solid #38383a;background:transparent;color:#fff;cursor:pointer}
body.light-theme .news-close{color:#1c1c1e;border-color:#e0e0e0}
.news-body{padding:12px 22px 0 22px;text-align:center;line-height:1.7;font-size:15px;opacity:.95;white-space:pre-line}
.news-foot{padding:22px;display:flex;justify-content:center}
.btn-ok{width:100%;max-width:420px;padding:14px 18px;border-radius:12px;border:none;font-weight:800;cursor:pointer}
body.dark-theme  .btn-ok{background:#0a84ff;color:#fff}
body.light-theme .btn-ok{background:#007aff;color:#fff}

/* Added styles for profile page sub-sections */
.profile-tabs{display:flex;gap:8px;margin-bottom:20px;overflow-x:auto;padding-bottom:8px}
.profile-tab{padding:10px 20px;border-radius:8px;border:none;background:transparent;cursor:pointer;font-weight:600;font-size:0.9rem;white-space:nowrap;transition:all 0.2s ease}
.light-theme .profile-tab{color:#6d6d72;border:1px solid #e0e0e0}
.dark-theme .profile-tab{color:#8e8e93;border:1px solid #38383a}
.profile-tab.active{font-weight:700}
.light-theme .profile-tab.active{background:#007aff;color:#fff;border-color:#007aff}
.dark-theme .profile-tab.active{background:#0a84ff;color:#fff;border-color:#0a84ff}
.profile-section{display:none}
.profile-section.active{display:block;animation:fadeIn .3s ease-in-out}
.withdrawal-item{padding:15px;border-radius:10px;margin-bottom:12px}
.light-theme .withdrawal-item{background:#fff;border:1px solid #e0e0e0}
.dark-theme .withdrawal-item{background:#1c1c1e;border:1px solid #38383a}
.withdrawal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
.withdrawal-amount{font-weight:700;font-size:1.1rem}
.light-theme .withdrawal-amount{color:#007aff}
.dark-theme .withdrawal-amount{color:#0a84ff}
.withdrawal-status{padding:4px 12px;border-radius:6px;font-size:0.8rem;font-weight:700}
.withdrawal-status.pending{background:#ff9500;color:#fff}
.withdrawal-status.approved{background:#30d158;color:#fff}
.withdrawal-status.rejected{background:#ff3b30;color:#fff}
.withdrawal-details{font-size:0.85rem;opacity:0.8;line-height:1.6}
.empty-state{text-align:center;padding:40px 20px;opacity:0.6}
.empty-state i{font-size:3rem;margin-bottom:15px;opacity:0.5}
.support-section{padding:20px;border-radius:12px}
.light-theme .support-section{background:#fff;border:1px solid #e0e0e0}
.dark-theme .support-section{background:#1c1c1e;border:1px solid #38383a}
.support-item{display:flex;align-items:center;gap:15px;padding:15px;margin-bottom:12px;border-radius:10px;cursor:pointer;transition:all 0.2s ease}
.light-theme .support-item{background:rgba(0,0,0,0.02)}
.light-theme .support-item:hover{background:rgba(0,122,255,0.08)}
.dark-theme .support-item{background:rgba(255,255,255,0.03)}
.dark-theme .support-item:hover{background:rgba(10,132,255,0.12)}
.support-icon{width:48px;height:48px;display:grid;place-items:center;border-radius:12px;font-size:1.5rem}
.light-theme .support-icon{background:rgba(0,122,255,0.1);color:#007aff}
.dark-theme .support-icon{background:rgba(10,132,255,0.15);color:#0a84ff}
.support-info{flex:1}
.support-title{font-weight:700;font-size:1rem;margin-bottom:4px}
.support-desc{font-size:0.85rem;opacity:0.8}
.full-leaderboard{padding:20px;border-radius:12px}
.light-theme .full-leaderboard{background:#fff;border:1px solid #e0e0e0}
.dark-theme .full-leaderboard{background:#1c1c1e;border:1px solid #38383a}

/* Updated bottom navigation to 4 items: Home, Tasks, Withdraw, Profile */
.bottom-nav{position:fixed;left:0;right:0;bottom:0;width:100%;max-width:500px;margin:0 auto;display:flex;justify-content:space-around;align-items:center;gap:8px;padding:6px 8px calc(env(safe-area-inset-bottom,0) + 6px);border-top:1px solid;z-index:1000;backdrop-filter:saturate(180%) blur(8px)}
.light-theme .bottom-nav{background:rgba(255,255,255,0.92);border-top-color:#e0e0e0}
.dark-theme .bottom-nav{background:rgba(28,28,30,0.92);border-top-color:#38383a}
.nav-btn{flex:1;min-width:0;max-width:120px;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:2px;padding:8px 6px;border:none;background:transparent;border-radius:12px;cursor:pointer;font-family:var(--font-family);font-size:.75rem;line-height:1.1;transition:transform .08s ease, background-color .15s ease, color .15s ease}
.nav-btn i{font-size:1.2rem;line-height:1}
.light-theme .nav-btn{color:#6d6d72}
.dark-theme  .nav-btn{color:#8e8e93}
.nav-btn:active{transform:scale(.96)}
.nav-btn.active{font-weight:700}
.light-theme .nav-btn.active{color:#007aff;background:rgba(0,122,255,.12)}
.dark-theme .nav-btn.active{color:#0a84ff;background:rgba(10,132,255,.14)}

#withdraw-page .form-group{margin-bottom:14px}
#withdraw-form label{display:block;margin-bottom:6px;font-size:.9rem;font-weight:700}
#withdraw-form input,#withdraw-form select{width:100%;padding:12px 14px;border-radius:8px;font-size:1rem;font-family:var(--font-family);outline:none;transition:.15s;border:1px solid;appearance:none}
body.light-theme #withdraw-form input,body.light-theme #withdraw-form select{background:#f4f4f9;border-color:#e0e0e0;color:#1c1c1e}
body.light-theme #withdraw-form input:focus,body.light-theme #withdraw-form select:focus{border-color:#007aff;box-shadow:0 0 0 3px rgba(0,122,255,.15)}
body.dark-theme #withdraw-form input,body.dark-theme #withdraw-form select{background:#1c1c1e;border-color:#38383a;color:#fff}
body.dark-theme #withdraw-form input:focus,body.dark-theme #withdraw-form select:focus{border-color:#0a84ff;box-shadow:0 0 0 3px rgba(10,132,255,.18)}
#withdraw-form input::placeholder{opacity:.7}
#withdraw-form select{background-position:right 14px center}
#withdraw-submit-btn{margin-top:8px;width:100%}
.check-modal{position:fixed;inset:0;display:none;place-items:center;background:rgba(0,0,0,.55);z-index:3500}
.check-modal.show{display:grid}
.check-card{width:min(420px,calc(100% - 40px));border-radius:18px;padding:22px;border:1px solid;text-align:center;box-shadow:0 20px 60px rgba(0,0,0,.45)}
body.dark-theme .check-card{background:#1c1c1e;border-color:#38383a;color:#fff}
body.light-theme .check-card{background:#fff;border-color:#e0e0e0;color:#1c1c1e}
.check-ring{width:64px;height:64px;margin:0 auto 14px;position:relative}
.check-ring:before,.check-ring:after{content:"";position:absolute;inset:0;border-radius:50%;border:4px solid transparent;border-top-color:currentColor;animation:spin 1s linear infinite}
.check-ring:after{inset:6px;border-width:4px;border-bottom-color:currentColor;animation-duration:1.4s;opacity:.7}
.check-title{font-weight:800;font-size:1.05rem;margin-bottom:6px}
.check-sub{font-size:.92rem;opacity:.85}
.check-ok{display:none;margin-top:8px;font-weight:800}
.check-modal.success .check-ok{display:block}
  </style>

</head>
<body>
   HTML STRUCTURE (no changes needed) 
  <div id="boot-overlay" aria-hidden="true">
    <div class="boot-card">
      <div class="boot-logo">
        <i class="fa-solid fa-bolt"></i>
      </div>
      <div class="boot-title">Loading your dashboard…</div>
      <div class="boot-sub">Securely syncing with Firebase</div>
      <div class="boot-progress">
        <div class="boot-bar"></div></div>
      <div class="boot-hint">Please wait a moment</div></div></div>  
  <div id="app" style="visibility:hidden">

    <header class="profile-header">
      <div class="profile-info">
        <div id="skel-avatar" class="skel skel-avatar"></div>
        <img id="user-photo" src="/placeholder.svg" alt="User Photo" style="display:none"/>
        <div class="user-details">
          <div id="skel-name" class="skel skel-line w80" style="margin:6px 0 8px">
          </div>
          <h1 id="user-name" style="display:none">Loading… <i class="fas fa-check-circle verified-icon"></i></h1>
          <div id="skel-balance" class="skel skel-line w60">
          </div>
          <p id="balance-line" style="display:none">ব্যালেন্স: <span id="user-balance">0</span> টাকা 💰</p></div></div><div id="mini-app-pill" class="mini-app-badge"><i class="fa-solid fa-hand-peace"></i> <span id="mini-app-text">ওয়েলকাম</span></div></header>
    
    <main id="main-content">
        Restructured pages: Home, Tasks, Withdraw, Profile 
      
        Home Page 
      <div id="home-page" class="page active">
        <h2>Dashboard</h2>
        <div id="skel-stats" class="stats-grid"><div class="stat-card"><div class="skel skel-line w60" style="height:16px;margin:0 auto 10px"></div><div class="skel" style="height:26px;border-radius:8px"></div></div><div class="stat-card"><div class="skel skel-line w60" style="height:16px;margin:0 auto 10px"></div><div class="skel" style="height:26px;border-radius:8px"></div></div></div>
        
        <div id="stats-real" class="stats-grid" style="display:none">
          <div class="stat-card"><h3>Daily Ads Watched</h3><p><span id="daily-ads-watched">0</span> / <span id="daily-ads-limit">10</span></p></div>
          <div class="stat-card"><h3>Total Referrals</h3><p id="referral-count">0</p></div>
        </div>
        
         Added leaderboard snapshot section 
        <div class="leaderboard-section" style="display:none" id="leaderboard-snapshot">
          <h3><i class="fas fa-trophy"></i> Top Earners</h3>
          <div id="leaderboard-list">
            <p class="notice-empty">Loading leaderboard...</p>
          </div>
        </div>
        
         Added recent notice section 
        <div class="notice-section" style="display:none" id="notice-section">
          <h3><i class="fas fa-bullhorn"></i> Recent Notice</h3>
          <div class="notice-content" id="notice-content">
            <p class="notice-empty">No recent notices</p>
          </div>
        </div>
      </div>
      
        Tasks Page 
      <div id="tasks-page" class="page">
        <h2>Complete Tasks</h2>
        
         Added Daily Login Bonus task 
        <div class="task-container">
          <i class="fas fa-calendar-check task-icon"></i>
          <h3>Daily Login Bonus</h3>
          <p id="daily-login-desc">প্রতিদিন অ্যাপে লগইন করে <b id="daily-login-reward">10</b> টাকা বোনাস পান।</p>
          <button id="claim-daily-login-btn" class="action-btn">
            <span class="btn-text">Claim Daily Bonus</span>
            <span class="btn-loader"></span>
          </button>
          <small id="daily-login-note" style="display:block;margin-top:6px;opacity:.8;"></small>
        </div>
        
        <div class="task-container"><i class="fas fa-video task-icon"></i><h3>Rewarded Ad</h3><p id="ad-reward-line">প্রতিটি বিজ্ঞাপনের জন্য <b id="ad-reward-label">5</b> টাকা আয় করুন।</p><p id="ad-verify-hint">অ্যাড দেখে আয় করতে ভেরিফাই করুন!</p><button id="watch-ad-btn" class="action-btn"><span class="btn-text">Verify (/start)</span><span class="btn-loader"></span></button><p id="ad-timer-note">পুরস্কার পেতে 15 সেকেন্ডের জন্য বিজ্ঞাপনে থাকুন।</p></div><div class="task-container"><i class="fab fa-telegram task-icon"></i><h3>Join our Telegram Channel</h3><p>চ্যানেলে জয়েন করুন, তারপর ফি��ে এসে "Check & Claim" দিন।</p><div style="display:flex;gap:10px"><button id="open-channel-btn" class="action-btn"><span class="btn-text">Open Channel</span></button><button id="check-channel-btn" class="action-btn"><span class="btn-text">Check & Claim</span></button></div><p id="channel-bonus-note" style="margin-top:10px;font-size:.85rem;opacity:.8;"></p><small id="channel-claimed-note" style="display:block;margin-top:6px;opacity:.8;"></small></div><div class="task-container"><i class="fab fa-youtube task-icon"></i><h3>Subscribe our YouTube</h3><p>Open YouTube এ ক্লিক করুন, সাবস্ক্রাইব করুন, তারপর "Check & Claim" দিন।</p><div style="display:flex;gap:10px"><button id="open-youtube-btn" class="action-btn"><span class="btn-text">Open YouTube</span></button><button id="claim-youtube-btn" class="action-btn"><span class="btn-text">Check & Claim</span></button></div><p id="youtube-bonus-note" style="margin-top:10px;font-size:.85rem;opacity:.8;"></p><small id="youtube-claimed-note" style="display:block;margin-top:6px;opacity:.8;"></small></div>
      </div>
      
        Withdraw Page 
      <div id="withdraw-page" class="page">
        <h2>Withdraw (টাকা)</h2><p>ন্যূনতম <b id="min-withdraw-label">1500</b> টাকা এবং কমপক্ষে <b id="req-ref-label">20</b> টি রেফারেল প্রয়োজন। </p><form id="withdraw-form"><div class="form-group"><label for="withdraw-method">Method:</label><select id="withdraw-method" required><option value="bKash">bKash</option><option value="Nagad">Nagad</option><option value="Rocket">Rocket</option></select></div><div class="form-group"><label for="account-number">Account Number:</label><input type="text" id="account-number" placeholder="01XXXXXXXXX" required /></div><div class="form-group"><label for="amount">Amount (Tk):</label><input type="number" id="amount" placeholder="1500" min="1" required /></div><button type="submit" id="withdraw-submit-btn" class="action-btn"><span class="btn-text">Submit Request</span><span class="btn-loader"></span></button></form>
      </div>
      
        Profile Page 
      <div id="profile-page" class="page">
        <h2>Profile</h2>
        
         Added profile tabs for sub-sections 
        <div class="profile-tabs">
          <button class="profile-tab active" data-section="refer-section">Refer & Earn</button>
          <button class="profile-tab" data-section="withdrawal-history-section">Withdrawal History</button>
          <button class="profile-tab" data-section="leaderboard-section">Leaderboard</button>
          <button class="profile-tab" data-section="support-section">Support</button>
        </div>
        
         Refer & Earn Section (moved from standalone) 
        <div id="refer-section" class="profile-section active">
          <div class="referral-section" id="profile-ref-section" style="visibility:hidden;margin-top:0">
            <h3>Refer & Earn More!</h3>
            <p class="ref-text">রেফার বোনাস পেতে লিংকটি কপি করে আপনার বন্ধুদের কাছে শেয়ার করুন। প্রতি রেফারে আয় <b><span id="profile-ref-bonus-label">30</span></b> টাকা.</p>
            <input type="text" id="profile-referral-link" readonly />
            <div class="ref-btns">
              <button id="profile-copy-ref-link-btn">Copy Referral Link</button>
              <button id="profile-share-on-telegram-btn" class="share-btn"><i class="fas fa-share-alt"></i> Share Now</button>
            </div>
            <small id="profile-referral-hint" style="display:block;margin-top:6px;opacity:.75;"></small>
          </div>
        </div>
        
         Added Withdrawal History Section 
        <div id="withdrawal-history-section" class="profile-section">
          <div id="withdrawal-history-list">
            <div class="empty-state">
              <i class="fas fa-wallet"></i>
              <p>Loading withdrawal history...</p>
            </div>
          </div>
        </div>
        
         Added Full Leaderboard Section 
        <div id="leaderboard-section" class="profile-section">
          <div class="full-leaderboard">
            <div id="full-leaderboard-list">
              <div class="empty-state">
                <i class="fas fa-trophy"></i>
                <p>Loading leaderboard...</p>
              </div>
            </div>
          </div>
        </div>
        
         Added Support Section 
        <div id="support-section" class="profile-section">
          <div class="support-section">
            <div class="support-item" id="contact-telegram">
              <div class="support-icon">
                <i class="fab fa-telegram"></i>
              </div>
              <div class="support-info">
                <div class="support-title">Contact on Telegram</div>
                <div class="support-desc">Get help from our support team</div>
              </div>
              <i class="fas fa-chevron-right" style="opacity:0.5"></i>
            </div>
            
            <div class="support-item" id="join-community">
              <div class="support-icon">
                <i class="fas fa-users"></i>
              </div>
              <div class="support-info">
                <div class="support-title">Join Community</div>
                <div class="support-desc">Connect with other users</div>
              </div>
              <i class="fas fa-chevron-right" style="opacity:0.5"></i>
            </div>
            
            <div class="support-item" id="report-issue">
              <div class="support-icon">
                <i class="fas fa-bug"></i>
              </div>
              <div class="support-info">
                <div class="support-title">Report an Issue</div>
                <div class="support-desc">Let us know about any problems</div>
              </div>
              <i class="fas fa-chevron-right" style="opacity:0.5"></i>
            </div>
            
            <div class="support-item" id="app-info">
              <div class="support-icon">
                <i class="fas fa-info-circle"></i>
              </div>
              <div class="support-info">
                <div class="support-title">App Information</div>
                <div class="support-desc">Version 4.0 - Red Chili Earn & Reward</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>
    
      Updated bottom navigation with 4 items 
    <nav class="bottom-nav">
      <button class="nav-btn active" data-page="home-page">
        <i class="fas fa-home"></i>
        <span>Home</span>
      </button>
      <button class="nav-btn" data-page="tasks-page">
        <i class="fas fa-tasks"></i>
        <span>Tasks</span>
      </button>
      <button class="nav-btn" data-page="withdraw-page">
        <i class="fas fa-wallet"></i>
        <span>Withdraw</span>
      </button>
      <button class="nav-btn" data-page="profile-page">
        <i class="fas fa-user"></i>
        <span>Profile</span>
      </button>
    </nav>
  </div>
  
  <div id="loading-modal" class="modal"><div class="modal-content"><div class="loader"></div><p id="loading-text">Loading Ad...</p><p id="countdown-text" style="margin-top:8px;font-weight:600;"></p></div></div>
  <div id="newsOverlay" class="news-overlay"></div><div id="newsModal" class="news-modal" role="dialog" aria-modal="true" aria-labelledby="newsTitle"><div class="news-hero"><button type="button" class="news-close" aria-label="Close">✕</button><h3 id="newsTitle">স্বাগতম!</h3><div class="news-emoji">🔥</div></div><div class="news-body" id="newsBody"></div><div class="news-foot"><button type="button" class="btn-ok" id="newsOkBtn">বুঝেছি</button></div></div>
  <div id="bonus-check-modal" class="check-modal" role="dialog" aria-modal="true" aria-labelledby="bonusCheckTitle"><div class="check-card"><div class="check-ring"></div><div class="check-title" id="bonusCheckTitle">Checking…</div><div class="check-sub" id="bonusCheckSub">Please wait while we verify your bonus.</div><div class="check-ok" id="bonusCheckOk">Verified ✅</div></div></div>

   Telegram SDK 
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  
   Ad Network SDKs 
  <script src='//libtl.com/sdk.js' data-zone='9289458' data-sdk='show_9289458'></script>
  <script src="https://ad.gigapub.tech/script?id=3387"></script>
  <script src="https://adexora.com/cdn/ads.js?id=488"></script>

   ================= FIREBASE SDKs ================= 
  <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-database-compat.js"></script>


<script>
document.addEventListener('DOMContentLoaded', async () => {

    // ============== Step 1: আপনার Firebase কনফিগারেশন এখানে বসান ===============
    const firebaseConfig = {
      apiKey: "AIzaSyD3d3dDeoQ7qbRJpDsgL02lCrBltMTyST4",
      authDomain: "eanr-money-2x.firebaseapp.com",
      databaseURL: "https://eanr-money-2x-default-rtdb.firebaseio.com",
      projectId: "eanr-money-2x",
      storageBucket: "eanr-money-2x.appspot.com",
      messagingSenderId: "697903088085",
      appId: "1:697903088085:web:bc9e6ec6e8e151618d7d5c",
      measurementId: "G-FZRXMW82QN"
    };
    
    // Firebase App শুরু করা হচ্ছে
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    // =========================================================================

    const tg = window.Telegram.WebApp;

    /* ======= CONFIG (defaults, Firebase থেকে লোড হবে) ======= */
    let CONFIG = {
        botUsername: "", channelId: null, channelUsername: "",
        adRewardTk: 0, channelBonusTk: 0, youtubeBonusTk: 0, referrerBonusTk: 0,
        defaultDailyLimit: 10, minWithdrawTk: 0, requiredReferrals: 0,
        newsText: "", newsIntervalMinutes: 0, adsEnabled: false,
        enforceChannelJoin: false, enforceYouTubeSubscribe: false,
        youtubeChannelId: "", dailyLoginBonusTk: 10
    };

    /* ======= USER DATA ======= */
    let USER = {
        id: null, username: "", firstName: "", lastName: "", photoUrl: "",
        balance: 0, referralCount: 0, dailyAdsWatched: 0, lastAdDate: "",
        channelJoined: false, youtubeSubscribed: false, referredBy: null,
        lastDailyLogin: ""
    };

    let currentUserId = null;

    /* ======= THEME ======= */
    function applyTheme() {
        const colorScheme = tg.colorScheme || 'dark';
        document.body.className = colorScheme === 'dark' ? 'dark-theme' : 'light-theme';
    }
    applyTheme();
    tg.onEvent('themeChanged', applyTheme);

    /* ======= BOOT OVERLAY ======= */
    function hideBootOverlay() {
        const overlay = document.getElementById('boot-overlay');
        overlay.style.opacity = '0';
        overlay.style.transition = 'opacity 0.4s ease';
        setTimeout(() => { overlay.style.display = 'none'; }, 400);
        document.getElementById('app').style.visibility = 'visible';
    }

    /* ======= LOAD CONFIG ======= */
    async function loadConfig() {
        const snap = await db.ref('config').once('value');
        if (snap.exists()) {
            const data = snap.val();
            CONFIG.botUsername = data.botUsername || "";
            CONFIG.channelId = data.channelId || null;
            CONFIG.channelUsername = data.channelUsername || "";
            CONFIG.adRewardTk = parseFloat(data.adRewardTk) || 0;
            CONFIG.channelBonusTk = parseFloat(data.channelBonusTk) || 0;
            CONFIG.youtubeBonusTk = parseFloat(data.youtubeBonusTk) || 0;
            CONFIG.referrerBonusTk = parseFloat(data.referrerBonusTk) || 0;
            CONFIG.defaultDailyLimit = parseInt(data.defaultDailyLimit) || 10;
            CONFIG.minWithdrawTk = parseFloat(data.minWithdrawTk) || 0;
            CONFIG.requiredReferrals = parseInt(data.requiredReferrals) || 0;
            CONFIG.newsText = data.newsText || "";
            CONFIG.newsIntervalMinutes = parseInt(data.newsIntervalMinutes) || 0;
            CONFIG.adsEnabled = !!data.adsEnabled;
            CONFIG.enforceChannelJoin = !!data.enforceChannelJoin;
            CONFIG.enforceYouTubeSubscribe = !!data.enforceYouTubeSubscribe;
            CONFIG.youtubeChannelId = data.youtubeChannelId || "";
            CONFIG.dailyLoginBonusTk = parseFloat(data.dailyLoginBonusTk) || 10;
        }
        updateUIWithConfig();
    }

    function updateUIWithConfig() {
        document.getElementById('ad-reward-label').textContent = CONFIG.adRewardTk;
        document.getElementById('daily-ads-limit').textContent = CONFIG.defaultDailyLimit;
        document.getElementById('min-withdraw-label').textContent = CONFIG.minWithdrawTk;
        document.getElementById('req-ref-label').textContent = CONFIG.requiredReferrals;
        document.getElementById('profile-ref-bonus-label').textContent = CONFIG.referrerBonusTk;
        document.getElementById('daily-login-reward').textContent = CONFIG.dailyLoginBonusTk;

        const channelNote = document.getElementById('channel-bonus-note');
        channelNote.textContent = `চ্যানেলে জয়েন করলে ${CONFIG.channelBonusTk} টাকা বোনাস পাবেন।`;

        const youtubeNote = document.getElementById('youtube-bonus-note');
        youtubeNote.textContent = `সাবস্ক্রাইব করলে ${CONFIG.youtubeBonusTk} টাকা বোনাস পাবেন।`;
    }

    /* ======= INIT USER ======= */
    async function initUser() {
        tg.ready();
        tg.expand();

        const initData = tg.initDataUnsafe;
        const user = initData?.user;
        if (!user || !user.id) {
            alert("Telegram user not found. Please open via Telegram.");
            return;
        }

        currentUserId = user.id;
        USER.id = user.id;
        USER.username = user.username || "";
        USER.firstName = user.first_name || "";
        USER.lastName = user.last_name || "";
        USER.photoUrl = user.photo_url || "/placeholder.svg?height=60&width=60";

        const startParam = initData?.start_param;
        if (startParam && startParam.startsWith('ref_')) {
            const referrerId = startParam.replace('ref_', '');
            if (referrerId !== String(USER.id)) {
                USER.referredBy = referrerId;
            }
        }

        const userRef = db.ref(`users/${USER.id}`);
        const snap = await userRef.once('value');

        if (!snap.exists()) {
            await userRef.set({
                id: USER.id,
                username: USER.username,
                firstName: USER.firstName,
                lastName: USER.lastName,
                photoUrl: USER.photoUrl,
                balance: 0,
                referralCount: 0,
                dailyAdsWatched: 0,
                lastAdDate: "",
                channelJoined: false,
                youtubeSubscribed: false,
                referredBy: USER.referredBy || null,
                joinedAt: Date.now(),
                lastDailyLogin: ""
            });

            if (USER.referredBy) {
                const refSnap = await db.ref(`users/${USER.referredBy}`).once('value');
                if (refSnap.exists()) {
                    const refData = refSnap.val();
                    const newBal = (refData.balance || 0) + CONFIG.referrerBonusTk;
                    const newCount = (refData.referralCount || 0) + 1;
                    await db.ref(`users/${USER.referredBy}`).update({
                        balance: newBal,
                        referralCount: newCount
                    });
                }
            }
        } else {
            const data = snap.val();
            USER.balance = data.balance || 0;
            USER.referralCount = data.referralCount || 0;
            USER.dailyAdsWatched = data.dailyAdsWatched || 0;
            USER.lastAdDate = data.lastAdDate || "";
            USER.channelJoined = !!data.channelJoined;
            USER.youtubeSubscribed = !!data.youtubeSubscribed;
            USER.referredBy = data.referredBy || null;
            USER.lastDailyLogin = data.lastDailyLogin || "";
        }

        resetDailyAdsIfNeeded();
        renderUserProfile();
        renderReferralSection();
        loadLeaderboardSnapshot();
        loadNoticeSection();
        // loadWithdrawalHistory(); // Moved to tab click
        // loadFullLeaderboard();   // Moved to tab click
        checkDailyLoginStatus();
        hideBootOverlay();
        maybeShowNews();
    }

    function renderUserProfile() {
        document.getElementById('skel-avatar').style.display = 'none';
        document.getElementById('skel-name').style.display = 'none';
        document.getElementById('skel-balance').style.display = 'none';
        document.getElementById('skel-stats').style.display = 'none';

        document.getElementById('user-photo').src = USER.photoUrl;
        document.getElementById('user-photo').style.display = 'block';
        document.getElementById('user-name').textContent = USER.firstName + (USER.lastName ? ' ' + USER.lastName : '');
        document.getElementById('user-name').style.display = 'block';
        document.getElementById('user-balance').textContent = USER.balance.toFixed(2);
        document.getElementById('balance-line').style.display = 'block';

        document.getElementById('stats-real').style.display = 'grid';
        document.getElementById('daily-ads-watched').textContent = USER.dailyAdsWatched;
        document.getElementById('referral-count').textContent = USER.referralCount;

        if (USER.channelJoined) {
            document.getElementById('channel-claimed-note').textContent = '✅ Already claimed';
        }
        if (USER.youtubeSubscribed) {
            document.getElementById('youtube-claimed-note').textContent = '✅ Already claimed';
        }
    }

    function renderReferralSection() {
        const refLink = `https://t.me/${CONFIG.botUsername}?start=ref_${USER.id}`;
        document.getElementById('profile-referral-link').value = refLink;
        document.getElementById('profile-ref-section').style.visibility = 'visible';
        document.getElementById('profile-referral-hint').textContent = `আপনার ${USER.referralCount} জন রেফারেল আছে।`;
    }

    async function loadLeaderboardSnapshot() {
        const leaderboardSection = document.getElementById('leaderboard-snapshot');
        const leaderboardList = document.getElementById('leaderboard-list');
        
        try {
            const snap = await db.ref('users').orderByChild('balance').limitToLast(5).once('value');
            if (!snap.exists()) {
                leaderboardList.innerHTML = '<p class="notice-empty">No users yet</p>';
                leaderboardSection.style.display = 'block';
                return;
            }

            const users = [];
            snap.forEach(child => {
                users.push(child.val());
            });
            users.reverse(); // Highest balance first

            if (users.length === 0) {
                leaderboardList.innerHTML = '<p class="notice-empty">No users yet</p>';
            } else {
                leaderboardList.innerHTML = users.slice(0, 3).map((u, idx) => {
                    const rank = idx + 1;
                    const rankClass = rank === 1 ? 'rank-1' : rank === 2 ? 'rank-2' : rank === 3 ? 'rank-3' : 'rank-other';
                    return `
                        <div class="leaderboard-item">
                            <div class="leaderboard-rank ${rankClass}">${rank}</div>
                            <div class="leaderboard-info">
                                <div class="leaderboard-name">${u.firstName || 'User'}</div>
                                <div class="leaderboard-value">Earned: <span class="leaderboard-amount">${(u.balance || 0).toFixed(2)} Tk</span></div>
                            </div>
                        </div>
                    `;
                }).join('');
            }
            
            leaderboardSection.style.display = 'block';
        } catch (err) {
            console.error('[v0] Error loading leaderboard:', err);
            leaderboardList.innerHTML = '<p class="notice-empty">Failed to load leaderboard</p>';
            leaderboardSection.style.display = 'block';
        }
    }

    function loadNoticeSection() {
        const noticeSection = document.getElementById('notice-section');
        const noticeContent = document.getElementById('notice-content');
        
        if (CONFIG.newsText && CONFIG.newsText.trim()) {
            noticeContent.innerHTML = CONFIG.newsText.trim();
            noticeSection.style.display = 'block';
        } else {
            noticeContent.innerHTML = '<p class="notice-empty">No recent notices</p>';
            noticeSection.style.display = 'block';
        }
    }
    
    async function loadWithdrawalHistory() {
        const historyList = document.getElementById('withdrawal-history-list');
        
        try {
            const snap = await db.ref('withdrawals').orderByChild('userId').equalTo(USER.id).once('value');
            
            if (!snap.exists()) {
                historyList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-wallet"></i>
                        <p>No withdrawal history yet</p>
                    </div>
                `;
                return;
            }

            const withdrawals = [];
            snap.forEach(child => {
                withdrawals.push({ id: child.key, ...child.val() });
            });
            
            // Sort by requestedAt descending
            withdrawals.sort((a, b) => (b.requestedAt || 0) - (a.requestedAt || 0));

            historyList.innerHTML = withdrawals.map(w => {
                const date = new Date(w.requestedAt).toLocaleDateString('bn-BD');
                const statusClass = w.status || 'pending';
                const statusText = statusClass === 'pending' ? 'Pending' : statusClass === 'approved' ? 'Approved' : 'Rejected';
                
                return `
                    <div class="withdrawal-item">
                        <div class="withdrawal-header">
                            <span class="withdrawal-amount">${w.amount} Tk</span>
                            <span class="withdrawal-status ${statusClass}">${statusText}</span>
                        </div>
                        <div class="withdrawal-details">
                            <div><strong>Method:</strong> ${w.method}</div>
                            <div><strong>Account:</strong> ${w.accountNumber}</div>
                            <div><strong>Date:</strong> ${date}</div>
                        </div>
                    </div>
                `;
            }).join('');
        } catch (err) {
            console.error('[v0] Error loading withdrawal history:', err);
            historyList.innerHTML = `
                <div class="empty-state">
                    <i class="fas fa-exclamation-triangle"></i>
                    <p>Failed to load withdrawal history</p>
                </div>
            `;
        }
    }

    async function loadFullLeaderboard() {
        const leaderboardList = document.getElementById('full-leaderboard-list');
        
        try {
            const snap = await db.ref('users').orderByChild('balance').limitToLast(50).once('value');
            
            if (!snap.exists()) {
                leaderboardList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-trophy"></i>
                        <p>No users yet</p>
                    </div>
                `;
                return;
            }

            const users = [];
            snap.forEach(child => {
                users.push(child.val());
            });
            users.reverse(); // Highest balance first

            leaderboardList.innerHTML = users.map((u, idx) => {
                const rank = idx + 1;
                const rankClass = rank === 1 ? 'rank-1' : rank === 2 ? 'rank-2' : rank === 3 ? 'rank-3' : 'rank-other';
                const isCurrentUser = u.id === USER.id;
                const highlightStyle = isCurrentUser ? 'style="border: 2px solid #30d158;"' : '';
                
                return `
                    <div class="leaderboard-item" ${highlightStyle}>
                        <div class="leaderboard-rank ${rankClass}">${rank}</div>
                        <div class="leaderboard-info">
                            <div class="leaderboard-name">${u.firstName || 'User'}${isCurrentUser ? ' (You)' : ''}</div>
                            <div class="leaderboard-value">Earned: <span class="leaderboard-amount">${(u.balance || 0).toFixed(2)} Tk</span></div>
                        </div>
                    </div>
                `;
            }).join('');
        } catch (err) {
            console.error('[v0] Error loading full leaderboard:', err);
            leaderboardList.innerHTML = `
                <div class="empty-state">
                    <i class="fas fa-exclamation-triangle"></i>
                    <p>Failed to load leaderboard</p>
                </div>
            `;
        }
    }


    function checkDailyLoginStatus() {
        const today = new Date().toISOString().split('T')[0];
        const btn = document.getElementById('claim-daily-login-btn');
        const note = document.getElementById('daily-login-note');
        
        if (!btn) return; // Guard against missing element

        if (USER.lastDailyLogin === today) {
            btn.disabled = true;
            btn.querySelector('.btn-text').textContent = 'Already Claimed Today';
            note.textContent = '✅ Come back tomorrow for another bonus!';
            note.style.color = '#30d158';
        } else {
            btn.disabled = false;
            btn.querySelector('.btn-text').textContent = 'Claim Daily Bonus';
            note.textContent = 'Available to claim now!';
            note.style.color = '';
        }
    }

    document.getElementById('claim-daily-login-btn')?.addEventListener('click', async function() {
        const today = new Date().toISOString().split('T')[0];
        
        if (USER.lastDailyLogin === today) {
            alert('You have already claimed your daily bonus today!');
            return;
        }

        const btn = this;
        btn.classList.add('loading');
        btn.disabled = true;

        try {
            const newBalance = USER.balance + CONFIG.dailyLoginBonusTk;
            await db.ref(`users/${USER.id}`).update({
                balance: newBalance,
                lastDailyLogin: today
            });

            USER.balance = newBalance;
            USER.lastDailyLogin = today;

            document.getElementById('user-balance').textContent = USER.balance.toFixed(2);
            
            btn.querySelector('.btn-text').textContent = 'Already Claimed Today';
            document.getElementById('daily-login-note').textContent = '✅ Come back tomorrow for another bonus!';
            document.getElementById('daily-login-note').style.color = '#30d158';

            alert(`🎉 Daily Login Bonus claimed! +${CONFIG.dailyLoginBonusTk} Tk`);
        } catch (err) {
            console.error('[v0] Daily login error:', err);
            alert('Failed to claim daily bonus. Please try again.');
            btn.disabled = false;
        } finally {
            btn.classList.remove('loading');
        }
    });

    /* ======= NEWS MODAL ======= */
    function maybeShowNews() {
        if (!CONFIG.newsText || !CONFIG.newsText.trim()) return;

        const lastShown = localStorage.getItem('lastNewsShown');
        const now = Date.now();
        const intervalMs = CONFIG.newsIntervalMinutes * 60 * 1000;

        if (!lastShown || (now - parseInt(lastShown)) > intervalMs) {
            showNewsModal();
            localStorage.setItem('lastNewsShown', String(now));
        }
    }

    function showNewsModal() {
        document.getElementById('newsBody').textContent = CONFIG.newsText;
        document.getElementById('newsOverlay').classList.add('show');
        document.getElementById('newsModal').classList.add('show');
    }

    function hideNewsModal() {
        document.getElementById('newsOverlay').classList.remove('show');
        document.getElementById('newsModal').classList.remove('show');
    }

    document.getElementById('newsOkBtn')?.addEventListener('click', hideNewsModal);
    document.querySelector('.news-close')?.addEventListener('click', hideNewsModal);
    document.getElementById('newsOverlay')?.addEventListener('click', hideNewsModal);

    /* ======= NAVIGATION ======= */
    const navBtns = document.querySelectorAll('.nav-btn');
    const pages = document.querySelectorAll('.page');

    navBtns.forEach(btn => {
        btn.addEventListener('click', () => {
            const targetPage = btn.getAttribute('data-page');
            navBtns.forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            pages.forEach(p => p.classList.remove('active'));
            document.getElementById(targetPage).classList.add('active');
        });
    });

    /* ======= PROFILE TABS ======= */
    const profileTabs = document.querySelectorAll('.profile-tab');
    const profileSections = document.querySelectorAll('.profile-section');

    profileTabs.forEach(tab => {
        tab.addEventListener('click', () => {
            const targetSection = tab.getAttribute('data-section');
            profileTabs.forEach(t => t.classList.remove('active'));
            tab.classList.add('active');
            profileSections.forEach(s => s.classList.remove('active'));
            document.getElementById(targetSection).classList.add('active');
            
            if (targetSection === 'withdrawal-history-section') {
                loadWithdrawalHistory();
            } else if (targetSection === 'leaderboard-section') {
                loadFullLeaderboard();
            }
        });
    });

    /* ======= REWARDED AD ======= */
    document.getElementById('watch-ad-btn')?.addEventListener('click', async function() {
        if (!CONFIG.adsEnabled) {
            alert('Ads are currently disabled by admin.');
            return;
        }

        if (USER.dailyAdsWatched >= CONFIG.defaultDailyLimit) {
            alert(`Daily limit reached (${CONFIG.defaultDailyLimit} ads).`);
            return;
        }

        const btn = this;
        btn.classList.add('loading');
        btn.disabled = true;

        const modal = document.getElementById('loading-modal');
        const loadingText = document.getElementById('loading-text');
        const countdownText = document.getElementById('countdown-text');
        modal.style.display = 'flex';
        loadingText.textContent = 'Loading Ad...';
        countdownText.textContent = '';

        try {
            if (typeof show_9289458 === 'function') {
                show_9289458();
            } else if (typeof gigapub_show === 'function') {
                gigapub_show();
            } else if (typeof adexora_show === 'function') {
                adexora_show();
            } else {
                throw new Error('No ad network available');
            }

            let countdown = 15;
            countdownText.textContent = `Please wait ${countdown} seconds...`;
            const interval = setInterval(() => {
                countdown--;
                if (countdown > 0) {
                    countdownText.textContent = `Please wait ${countdown} seconds...`;
                } else {
                    clearInterval(interval);
                    countdownText.textContent = 'Verifying...';
                }
            }, 1000);

            await new Promise(resolve => setTimeout(resolve, 15000));

            const newBalance = USER.balance + CONFIG.adRewardTk;
            const newAdsWatched = USER.dailyAdsWatched + 1;

            await db.ref(`users/${USER.id}`).update({
                balance: newBalance,
                dailyAdsWatched: newAdsWatched
            });

            USER.balance = newBalance;
            USER.dailyAdsWatched = newAdsWatched;

            document.getElementById('user-balance').textContent = USER.balance.toFixed(2);
            document.getElementById('daily-ads-watched').textContent = USER.dailyAdsWatched;

            modal.style.display = 'none';
            alert(`Ad watched! +${CONFIG.adRewardTk} Tk`);
        } catch (err) {
            console.error('[v0] Ad error:', err);
            modal.style.display = 'none';
            alert('Failed to load ad. Please try again.');
        } finally {
            btn.classList.remove('loading');
            btn.disabled = false;
        }
    });

    /* ======= CHANNEL JOIN ======= */
    document.getElementById('open-channel-btn')?.addEventListener('click', () => {
        if (!CONFIG.channelUsername) {
            alert('Channel not configured.');
            return;
        }
        window.open(`https://t.me/${CONFIG.channelUsername}`, '_blank');
    });

    document.getElementById('check-channel-btn')?.addEventListener('click', async function() {
        if (USER.channelJoined) {
            alert('You have already claimed the channel bonus.');
            return;
        }

        const btn = this;
        btn.classList.add('loading');
        btn.disabled = true;

        const bonusModal = document.getElementById('bonus-check-modal');
        const bonusTitle = document.getElementById('bonusCheckTitle');
        const bonusSub = document.getElementById('bonusCheckSub');
        bonusModal.classList.add('show');
        bonusTitle.textContent = 'Checking...';
        bonusSub.textContent = 'Please wait while we verify your channel membership.';

        try {
            await new Promise(resolve => setTimeout(resolve, 2000));

            const newBalance = USER.balance + CONFIG.channelBonusTk;
            await db.ref(`users/${USER.id}`).update({
                balance: newBalance,
                channelJoined: true
            });

            USER.balance = newBalance;
            USER.channelJoined = true;

            document.getElementById('user-balance').textContent = USER.balance.toFixed(2);
            document.getElementById('channel-claimed-note').textContent = '✅ Already claimed';

            bonusModal.classList.add('success');
            bonusTitle.textContent = 'Success!';
            bonusSub.textContent = `Channel bonus claimed! +${CONFIG.channelBonusTk} Tk`;

            setTimeout(() => {
                bonusModal.classList.remove('show', 'success');
            }, 2000);
        } catch (err) {
            console.error('[v0] Channel check error:', err);
            bonusModal.classList.remove('show');
            alert('Failed to verify channel membership. Please try again.');
        } finally {
            btn.classList.remove('loading');
            btn.disabled = false;
        }
    });

    /* ======= YOUTUBE SUBSCRIBE ======= */
    document.getElementById('open-youtube-btn')?.addEventListener('click', () => {
        if (!CONFIG.youtubeChannelId) {
            alert('YouTube channel not configured.');
            return;
        }
        window.open(`https://www.youtube.com/channel/${CONFIG.youtubeChannelId}?sub_confirmation=1`, '_blank');
    });

    document.getElementById('claim-youtube-btn')?.addEventListener('click', async function() {
        if (USER.youtubeSubscribed) {
            alert('You have already claimed the YouTube bonus.');
            return;
        }

        const btn = this;
        btn.classList.add('loading');
        btn.disabled = true;

        const bonusModal = document.getElementById('bonus-check-modal');
        const bonusTitle = document.getElementById('bonusCheckTitle');
        const bonusSub = document.getElementById('bonusCheckSub');
        bonusModal.classList.add('show');
        bonusTitle.textContent = 'Checking...';
        bonusSub.textContent = 'Please wait while we verify your subscription.';

        try {
            await new Promise(resolve => setTimeout(resolve, 2000));

            const newBalance = USER.balance + CONFIG.youtubeBonusTk;
            await db.ref(`users/${USER.id}`).update({
                balance: newBalance,
                youtubeSubscribed: true
            });

            USER.balance = newBalance;
            USER.youtubeSubscribed = true;

            document.getElementById('user-balance').textContent = USER.balance.toFixed(2);
            document.getElementById('youtube-claimed-note').textContent = '✅ Already claimed';

            bonusModal.classList.add('success');
            bonusTitle.textContent = 'Success!';
            bonusSub.textContent = `YouTube bonus claimed! +${CONFIG.youtubeBonusTk} Tk`;

            setTimeout(() => {
                bonusModal.classList.remove('show', 'success');
            }, 2000);
        } catch (err) {
            console.error('[v0] YouTube check error:', err);
            bonusModal.classList.remove('show');
            alert('Failed to verify subscription. Please try again.');
        } finally {
            btn.classList.remove('loading');
            btn.disabled = false;
        }
    });

    /* ======= REFERRAL COPY & SHARE ======= */
    document.getElementById('profile-copy-ref-link-btn')?.addEventListener('click', () => {
        const input = document.getElementById('profile-referral-link');
        if (!input) return;
        input.select();
        input.setSelectionRange(0, 99999);
        navigator.clipboard.writeText(input.value).then(() => {
            alert('Referral link copied!');
        }).catch(() => {
            alert('Failed to copy link.');
        });
    });

    document.getElementById('profile-share-on-telegram-btn')?.addEventListener('click', () => {
        const refLinkInput = document.getElementById('profile-referral-link');
        if (!refLinkInput) return;
        const refLink = refLinkInput.value;
        const shareText = encodeURIComponent(`Join this amazing Earn & Reward app and start earning today! ${refLink}`);
        window.open(`https://t.me/share/url?url=${encodeURIComponent(refLink)}&text=${shareText}`, '_blank');
    });

    /* ======= WITHDRAW ======= */
    document.getElementById('withdraw-form')?.addEventListener('submit', async function(e) {
        e.preventDefault();

        if (USER.balance < CONFIG.minWithdrawTk) {
            alert(`Minimum withdrawal amount is ${CONFIG.minWithdrawTk} Tk.`);
            return;
        }

        if (USER.referralCount < CONFIG.requiredReferrals) {
            alert(`You need at least ${CONFIG.requiredReferrals} referrals to withdraw.`);
            return;
        }

        const method = document.getElementById('withdraw-method').value;
        const accountNumber = document.getElementById('account-number').value.trim();
        const amount = parseFloat(document.getElementById('amount').value);

        if (!accountNumber) {
            alert('Please enter your account number.');
            return;
        }

        if (amount < CONFIG.minWithdrawTk || amount > USER.balance) {
            alert(`Invalid amount. Must be between ${CONFIG.minWithdrawTk} and ${USER.balance} Tk.`);
            return;
        }

        const btn = document.getElementById('withdraw-submit-btn');
        btn.classList.add('loading');
        btn.disabled = true;

        try {
            const withdrawalRef = db.ref('withdrawals').push();
            await withdrawalRef.set({
                userId: USER.id,
                username: USER.username,
                firstName: USER.firstName,
                method: method,
                accountNumber: accountNumber,
                amount: amount,
                status: 'pending',
                requestedAt: Date.now()
            });

            const newBalance = USER.balance - amount;
            await db.ref(`users/${USER.id}`).update({
                balance: newBalance
            });

            USER.balance = newBalance;
            document.getElementById('user-balance').textContent = USER.balance.toFixed(2);

            alert('Withdrawal request submitted successfully!');
            document.getElementById('withdraw-form').reset();
        } catch (err) {
            console.error('[v0] Withdrawal error:', err);
            alert('Failed to submit withdrawal request. Please try again.');
        } finally {
            btn.classList.remove('loading');
            btn.disabled = false;
        }
    });

    /* ======= SUPPORT SECTION LINKS ======= */
    document.getElementById('contact-telegram').addEventListener('click', () => {
      if (CONFIG.botUsername) {
            window.open(`https://t.me/${CONFIG.botUsername}`, '_blank');
        } else {
            alert('Support contact not configured.');
        }
    });

    document.getElementById('join-community').addEventListener('click', () => {
      if (CONFIG.channelUsername) {
            window.open(`https://t.me/${CONFIG.channelUsername}`, '_blank');
        } else {
            alert('Community channel not configured.');
        }
    });

    document.getElementById('report-issue').addEventListener('click', () => {
        const issueText = prompt('Please describe the issue you are facing:');
        if (issueText && issueText.trim()) {
            alert('Thank you for your report! Our team will look into it.');
            // In a real app, this would send the issue to the admin
        }
    });

    document.getElementById('app-info').addEventListener('click', () => {
        alert('Red Chili Earn & Reward App\nVersion 4.0\n\nDeveloped with Firebase & Telegram Mini Apps');
    });

    /* ======= INIT ======= */
    await loadConfig();
    await initUser();
});
</script>

</body>
</html>
